const db = window.firebase && firebase.firestore ? firebase.firestore() : null;
window.API={async getUsers(){return (await db.collection('users').get()).docs.map(d=>({id:d.id,...d.data()}));},async getUser(uid){return (await db.collection('users').doc(uid).get()).data();},async setUser(uid,data){return db.collection('users').doc(uid).set(data,{merge:true});},async add(col,data){return db.collection(col).add({...data,createdAt:firebase.firestore.FieldValue.serverTimestamp()});},async list(col,limitN=25){return (await db.collection(col).orderBy('createdAt','desc').limit(limitN).get()).docs.map(d=>({id:d.id,...d.data()}));},async del(col,id){return db.collection(col).doc(id).delete();}};
window.uploadImage=async function(file){if(typeof uploadToCloudinary==="function"){return await uploadToCloudinary(file);}throw new Error("uploadToCloudinary(file) tidak ditemukan. Pastikan scripts/cloudinary.js diload.");};
